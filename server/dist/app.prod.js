"use strict";var express=require("express"),logger=require("morgan"),cookieParser=require("cookie-parser"),app=express(),bodyParser=require("body-parser"),expressSession=require("express-session"),mongoose=require("mongoose"),hash=require("bcrypt-nodejs"),path=require("path"),passport=require("passport"),localStrategy=require("passport-local").Strategy,debug=require("debug")("passport-mongo"),formidable=require("formidable"),http=require("http").Server(app),cors=require("cors");app.use(cors()),app.get("/chat",function(e,r){r.sendFile(__dirname+"/index1.html")}),mongoose.connect("mongodb://localhost/shops");var db=mongoose.connection;db.on("error",console.error.bind(console,"DB connection error: ")),db.once("open",function(){console.log("DB connection success! ")});var products=require("./models/products"),posts=require("./models/posts"),categories=require("./models/categories"),user=require("./models/user"),productUser=require("./models/productUsers");app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(require("express-session")({secret:"keyboard cat",resave:!1,saveUninitialized:!1})),app.use(express.static(path.join(__dirname,"../"))),app.use(passport.initialize()),app.use(passport.session()),passport.use(new localStrategy(user.authenticate())),passport.serializeUser(user.serializeUser()),passport.deserializeUser(user.deserializeUser());var index=require("./routes/index"),product=require("./routes/product"),post=require("./routes/post"),category=require("./routes/category"),productUsers=require("./routes/productUsers"),users=require("./routes/users"),uploadRoutesApi=require("./routes/upload"),postProduct=require("./routes/postProduct");app.use("/",index),app.use("/api/user",users),app.use("/api/products",product),app.use("/api/posts",post),app.use("/api/categories",category),app.use("/api/productUsers",productUsers),app.use("/upload",uploadRoutesApi),app.use("/api/postproduct",postProduct),app.set("port",process.env.PORT||3e3);var server=app.listen(app.get("port"),function(){debug("Express server listening on port "+server.address().port)}),io=require("socket.io").listen(server);io.on("connection",function(e){var s=Math.floor(1e4*Math.random()+1);e.emit("my id",s),e.on("chat message",function(e){var r={user_id:s,msg:e};io.emit("chat message",r)}),e.on("connection success",function(e){var r={user_id:s,msg:e};io.emit("connection success",r)}),e.on("disconnect",function(e){io.emit("disconnected","user-"+s)})}),module.exports=app;